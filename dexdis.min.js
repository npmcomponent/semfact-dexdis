!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("dexdis",[],b):a.Dexdis=b()}(this,function(){var Dexdis,a,b,DexdisTransaction,c,d,e,f=[].slice,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};return c={transaction:"Operation not allowed during transaction",wrongargs:"Wrong number of arguments",wrongtype:"Operation against a key holding the wrong kind of value",notsupported:"Operation not supported",toomuchop:"Operation with too much operands"},d=["keys","simple","hash"],d=["keys","simple","hash"],a=function(){function a(a){var b,c,e;for(this._stores={},c=0,e=d.length;e>c;c++)b=d[c],this._stores[b]=a.objectStore(b);this.onerror=function(){}}var b;return a.prototype._checkttl=function(a,b,d){var e,f,g,h;h=this._stores.keys,f=this.onerror,"function"==typeof b&&(d=b,b=null),e=function(a){return null!=b&&null!=a&&a.type!==b?(f(new Error(c.wrongtype)),void 0):d(a)},g=h.get(a),g.onsuccess=function(){var b,c;return c=g.result,null!=(null!=c?c.expire:void 0)?Date.now()>c.expire?(b=h["delete"](a),b.onsuccess=function(){return d(void 0)},this._delvalue(k,c.type)):e(c):e(c)}},a.prototype._delvalue=function(a,b,c){var d,e,f;switch(f=this._stores,b){case"simple":d=f.simple["delete"](a),d.onsuccess=c;break;case"hash":e=IDBKeyRange.bound([a,0],[a,1],!0,!0),d=f.hash["delete"](e),d.onsuccess=c;break;default:null!=c&&c()}},a.prototype._expiremap=function(a,b,c){var d;d=this._stores.keys,this._checkttl(a,function(e){var f;return void 0!==e?(e.expire=c(e.expire),f=d.put(e,a),f.onsuccess=function(){return b(1)}):b(0)})},a.prototype._getstr=function(a,b){var d;return d=this.onerror,this.get(a,function(a){var e;if(null!=a){if(e=typeof a,"string"!==e){if("number"!==e)return d(Error(c.wrongtype)),void 0;a=""+a}}else a="";return b(a)})},a.prototype._hget=function(a,b,c){var d,e;return e=this._stores.hash,d=e.get([a,0,b]),d.onsuccess=function(){return void 0===d.result?c(null):c(d.result)}},a.prototype._hset=function(a,b,c,d){var e,f,g,h,i;i=this._stores,h=i.keys,f=i.hash,g=[a,0,b],e=f.count(g),e.onsuccess=function(){var b,i,j;return i=0===e.result,i&&(b={type:"hash"},h.put(b,a)),j=f.put(c,g),j.onsuccess=function(){return i?d(1):d(0)}}},a.prototype._map=function(a,b,c){var d,e,f,g,h=this;g=this._stores,d=g.keys,e=g.simple,f=null,this._checkttl(a,"simple",function(d){var g;return null!=d?(g=e.get(a),g.onsuccess=function(){var d;return f=c(g.result),d=e.put(f,a),d.onsuccess=function(){return b(f)}}):(f=c(null),h.set(a,f,function(){return b(f)}))})},a.prototype._ttlmap=function(a,b,c){this._checkttl(a,function(a){var d;return void 0!==a?(d=-1,null!=a.expire&&(d=a.expire-Date.now(),null!=c&&(d=c(d))),b(d)):b(-2)})},a.prototype.append=function(a,b,c){var d,e;return e=0,d=function(){return c(e)},this._map(a,d,function(a){var c;return c=null!=a?a+b:b,e=c.length,c})},b=function(a){var b,c,d;return b=1431655765,c=858993459,d=252645135,a-=a>>1&b,a=(a&c)+(a>>2&c),a=a+(a>>4)&d,a+=a>>8,a+=a>>16,127&a},a.prototype.bitcount=function(){var a,c,d,e;return c=arguments[0],d=3<=arguments.length?f.call(arguments,1,e=arguments.length-1):(e=1,[]),a=arguments[e++],this._getstr(c,function(c){var e,f;return 2===d.length&&(f=d[0],e=d[1],0>f&&(f=4+f),0>e&&(e=4+e+1),c&=-1>>>32-8*e,c>>>=8*f),a(b(c))})},a.prototype.bitop=function(){var a,b,d,e,g,h,i,j,k,l,m=this;switch(i=arguments[0],b=arguments[1],j=4<=arguments.length?f.call(arguments,2,l=arguments.length-1):(l=2,[]),a=arguments[l++],d=null,g=0,i.toUpperCase()){case"NOT":if(d=function(a,b){return~b},j.length>1)return this.onerror(Error(c.toomuchop)),void 0;break;case"AND":d=function(a,b){return a&b},g=-1;break;case"OR":d=function(a,b){return a|b};break;case"XOR":d=function(a,b){return a^b}}return null===d?(this.onerror(Error(c.notsupported)),void 0):(k=[],e=0,h=function(c){var f,i;return void 0!==c&&k.push(c),e++,e>j.length?(i=k.reduce(d,g),m.set(b,i,function(){return a((""+i).length)}),void 0):(f=j[e-1],m.get(f,h))},h())},a.prototype.dbsize=function(a){var b,c;return c=this._stores.keys,b=c.count(),b.onsuccess=function(){return a(b.result)}},a.prototype.decr=function(a,b){return this.decrby(a,1,b)},a.prototype.decrby=function(a,b,c){return this.incrby(a,-b,c)},a.prototype.del=function(){var a,b,c,d,e,g,h,i,j,k,l,m=this;if(d=2<=arguments.length?f.call(arguments,0,j=arguments.length-1):(j=0,[]),b=arguments[j++],h=this._stores,0===d.length)return b(0),void 0;for(c=0,a=0,g=d.length,i=function(d){return m._checkttl(d,function(e){return a++,null!=e&&(c++,h.keys["delete"](d),m._delvalue(d,e.type)),a===g?b(c):void 0})},k=0,l=d.length;l>k;k++)e=d[k],i(e)},a.prototype.exists=function(a,b){return this._checkttl(a,function(a){return null!=a?b(1):b(0)})},a.prototype.expire=function(a,b,c){return this._expiremap(a,c,function(){return Date.now()+1e3*b})},a.prototype.expireat=function(a,b,c){return this._expiremap(a,c,function(){return 1e3*b})},a.prototype.flushdb=function(a){var b,c,e,f;for(c=this._stores,c.keys.clear(),e=0,f=d.length;f>e;e++)b=d[e],c[b].clear();a("OK")},a.prototype.get=function(a,b){var c,d,e;e=this._stores,c=e.keys,d=e.simple,this._checkttl(a,"simple",function(c){var e;return void 0===c?b(null):(e=d.get(a),e.onsuccess=function(){return b(e.result)})})},a.prototype.getbit=function(a,b,c){return this._getstr(a,function(a){return b>31?c(0):c(1&a>>>b)})},a.prototype.getrange=function(a,b,c,d){return this._getstr(a,function(a){var e;return e=a.length,0>b&&(b=e+b),0>c&&(c=e+c+1),d(a.substring(b,c))})},a.prototype.getset=function(a,b,c){var d=this;return this.get(a,function(e){return d.set(a,b,function(){return c(e)})})},a.prototype.hcursor=function(){var a,b,d,e,g,h,i,j,k,l;return e=arguments[0],a=3<=arguments.length?f.call(arguments,1,l=arguments.length-1):(l=1,[]),b=arguments[l++],g=a.length,0!==g&&2!==g&&4!==g?(this.onerror(new Error(c.wrongargs)),void 0):(g>1&&(h=!1,j=!1,i=a[0],k=a[1]),4===g&&(h=a[2],j=a[3]),d=this._stores.hash,this._checkttl(e,"hash",function(a){var c,f;null!=a?(f=0===g?IDBKeyRange.bound([e,0],[e,1],!0,!0):IDBKeyRange.bound([e,0,i],[e,0,k],h,j),c=d.openCursor(f),c.onsuccess=function(){return void 0===c.result?b(null):b(c.result)}):b(null)}),void 0)},a.prototype.hdel=function(){var a,b,c,d,e;return d=arguments[0],b=3<=arguments.length?f.call(arguments,1,e=arguments.length-1):(e=1,[]),a=arguments[e++],0===b.length?(a(0),void 0):(c=this._stores.hash,this._checkttl(d,"hash",function(e){var f,g,h,i,j,k,l;if(null!=e){for(g=0,f=0,i=b.length,l=[],j=0,k=b.length;k>j;j++)h=b[j],l.push(function(b){var e,h;return h=[d,0,b],e=c.count(h),e.onsuccess=function(){var b;return f++,1===e.result&&(g++,b=c["delete"](h)),f===i?a(g):void 0}}(h));return l}return a(0)}))},a.prototype.hexists=function(a,b,c){var d;return d=this._stores.hash,this._checkttl(a,"hash",function(e){var f;return null!=e?(f=d.count([a,0,b]),f.onsuccess=function(){return c(f.result)}):c(0)})},a.prototype.hget=function(a,b,c){var d,e=this;d=this._stores.hash,this._checkttl(a,"hash",function(){e._hget(a,b,c)})},a.prototype.hgetall=function(a,b){var c;return c=[],this.hcursor(a,function(a){return null!=a?void 0!==a.key?(c.push(a.key[2]),c.push(a.value),a["continue"]()):b(c):b(c)})},a.prototype.hincrby=function(a,b,c,d){var e=this;this.hget(a,b,function(f){var g;g=null!=f?f+c:c,e._hset(a,b,g,function(){return d(g)})})},a.prototype.hkeys=function(a,b){var c;return c=[],this.hcursor(a,function(a){return null!=a?void 0!==a.key?(c.push(a.key[2]),a["continue"]()):b(c):b(c)})},a.prototype.hlen=function(a,b){var c;return c=this._stores.hash,this._checkttl(a,"hash",function(d){var e,f;return null!=d?(f=IDBKeyRange.bound([a,0],[a,1],!0,!0),e=c.count(f),e.onsuccess=function(){return b(e.result)}):b(0)})},a.prototype.hmget=function(){var a,b,c,d,e=this;c=arguments[0],a=3<=arguments.length?f.call(arguments,1,d=arguments.length-1):(d=1,[]),b=arguments[d++],this._checkttl(c,"hash",function(){var d,f,g,h,i,j,k;for(h=[],d=0,i=function(f,g){return e._hget(c,f,function(c){return h[g]=c,d++,d===a.length?b(h):void 0})},g=j=0,k=a.length;k>j;g=++j)f=a[g],i(f,g)})},a.prototype.hmset=function(){var a,b,d,e,g=this;return d=arguments[0],a=3<=arguments.length?f.call(arguments,1,e=arguments.length-1):(e=1,[]),b=arguments[e++],0!==a.length%2?(this.onerror(new Error(c.wrongargs)),void 0):(this._checkttl(d,"hash",function(){var c,e,f,h,i;for(e=h=0,i=a.length;i>h;e=h+=2)c=a[e],f=a[e+1],g._hset(d,c,f,function(){}),e===a.length-2&&b("OK")}),void 0)},a.prototype.hset=function(a,b,c,d){var e=this;this._checkttl(a,"hash",function(){e._hset(a,b,c,d)})},a.prototype.hsetnx=function(a,b,c,d){var e,f=this;e=this._stores.hash,this.hexists(a,b,function(e){return 0===e?f._hset(a,b,c,d):d(0)})},a.prototype.hvals=function(a,b){var c;return c=[],this.hcursor(a,function(a){return null!=a?void 0!==a.key?(c.push(a.value),a["continue"]()):b(c):b(c.sort())})},a.prototype.incr=function(a,b){return this.incrby(a,1,b)},a.prototype.incrby=function(a,b,c){return this._map(a,c,function(a){return a+b})},a.prototype.persist=function(a,b){var c;c=this._stores.keys,this._checkttl(a,function(d){var e,f;return void 0!==d?(f=0,null!=d.expire&&(delete d.expire,f=1),e=c.put(d,a),e.onsuccess=function(){return b(f)}):b(0)})},a.prototype.pexpire=function(a,b,c){return this._expiremap(a,c,function(){return Date.now()+b})},a.prototype.pexpireat=function(a,b,c){return this._expiremap(a,c,function(){return b})},a.prototype.psetex=function(a,b,c,d){var e=this;return this.set(a,c,function(){return e.pexpire(a,b,function(){return d("OK")})})},a.prototype.pttl=function(a,b){return this._ttlmap(a,b)},a.prototype.randomkey=function(a){var b,c;return c=this._stores.keys,b=c.count(),b.onsuccess=function(){var d,e,f;return f=Math.floor(Math.random()*b.result),e=c.openCursor(),d=!1,e.onsuccess=function(){var b;return b=e.result,null!=b?d||0===f?a(b.key):(d=!0,b.advance(f)):void 0}}},a.prototype.set=function(a,b,c){var d,e,f,g,h;h=this._stores,e=h.keys,g=h.simple,d={type:"simple"},e.put(d,a),f=g.put(b,a),f.onsuccess=function(){return c("OK")}},a.prototype.setbit=function(a,b,c,d){var e=this;return this._getstr(a,function(f){var g,h;return c&=1,g=1<<b,h=f&~g|c<<b,e.set(a,h,function(){return 0!==(f&g)?d(1):d(0)})})},a.prototype.setex=function(a,b,c,d){var e=this;return this.set(a,c,function(){return e.expire(a,b,function(){return d("OK")})})},a.prototype.setnx=function(a,b,c){var d=this;this._checkttl(a,"simple",function(e){return null!=e?c(0):d.set(a,b,function(){return c(1)})})},a.prototype.setrange=function(a,b,c,d){var e=this;return this._getstr(a,function(f){var g,h,i,j;return g=c.length,h=f.substring(0,b),j=f.substr(b+g),i=h+c+j,e.set(a,i,function(){return d(i.length)})})},a.prototype.strlen=function(a,b){return this._getstr(a,function(a){return b(a.length)})},a.prototype.ttl=function(a,b){return this._ttlmap(a,b,function(a){return Math.round(a/1e3)})},a.prototype.type=function(a,b){return this._checkttl(a,function(a){return null!=a?b(a.type):b("none")})},a}(),a.cmds=Object.keys(a.prototype).filter(function(a){return"_"!==a[0]}),b=function(){function a(){}return a.prototype._transaction=function(a,b){var c;return null==b&&(b="readwrite"),c=this.db.transaction(d,b),c.onerror=function(b){return null!=a?a(b):void 0},c},a}(),Dexdis=function(b){function Dexdis(){return e=Dexdis.__super__.constructor.apply(this,arguments)}var c,g,i,j,k;for(h(Dexdis,b),Dexdis.prototype._cmd=function(b,c,d,e){var f,g,h,i,j;h=null,g=null,i=function(a){h=a},j=this._transaction(d,e),j.oncomplete=function(){return null!=d?d(null,h):void 0},j.onabort=function(){return null!=g?d(g):void 0},f=new a(j),f.onerror=function(a){return g=a,j.abort()},f[b].apply(f,c.concat([i]))},Dexdis.prototype.select=function(a,b){var c,e=this;return"function"==typeof a&&(b=a,a=1),c=indexedDB.open(a,1),c.onupgradeneeded=function(){var b,e,f,g;for(a=c.result,g=[],e=0,f=d.length;f>e;e++)b=d[e],g.push(a.createObjectStore(b));return g},c.onsuccess=function(){return e.db=c.result,null!=b?b(null):void 0},c.onerror=function(a){return b(c.error),a.preventDefault()},this},Dexdis.prototype.quit=function(a){return null!=this.db&&this.db.close(),null!=a&&a(null),this},Dexdis.prototype.multi=function(){return new DexdisTransaction(this.db)},k=a.cmds,g=function(a){return Dexdis.prototype[a]=function(){var b,c,d;return b=2<=arguments.length?f.call(arguments,0,d=arguments.length-1):(d=0,[]),c=arguments[d++],"function"==typeof c?this._cmd(a,b,c):(b=b.concat([c]),this._cmd(a,b,function(){})),this}},i=0,j=k.length;j>i;i++)c=k[i],g(c);return Dexdis}.call(this,b),DexdisTransaction=function(b){function DexdisTransaction(a){this.db=a,this.buffer=[]}var c,d,e,g,i;for(h(DexdisTransaction,b),DexdisTransaction.prototype._buffercmd=function(a,b){return this.buffer.push({cmd:a,args:b})},DexdisTransaction.prototype.exec=function(b){var c,d,e,f,g,h;g=this._transaction(b),d=new a(g),c=this.buffer,e=0,h=[],f=function(a){var b;return void 0!==a&&h.push(a),e++,e>c.length?void 0:(b=c[e-1],d[b.cmd].apply(d,b.args.concat([f])))},g.oncomplete=function(){return b(null,h)},g.onerror=function(a){return b(a),a.preventDefault()},f()},DexdisTransaction.prototype.discard=function(){return this.buffer=[],this.trans.abort()},i=a.cmds,d=function(a){return DexdisTransaction.prototype[a]=function(){var b;return b=1<=arguments.length?f.call(arguments,0):[],this._buffercmd(a,b),this}},e=0,g=i.length;g>e;e++)c=i[e],d(c);return DexdisTransaction}.call(this,b),Dexdis});
//# sourceMappingURL=dexdis.min.js.map